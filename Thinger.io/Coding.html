<h2>編寫程式</h2>
<p>原文參照：<a href="https://docs.thinger.io/coding">https://docs.thinger.io/coding</a></p>
<p>以下將為您展示 Thinger.io 平台所提供的各種方法與基礎操作方法</p>
<hr><h3 ex_nav id="架構概觀">架構概觀</h3>
<p>一支經典的Arduino程式結構通常長得像這樣，它具有一個<code>setup()</code>方法與一個<code>loop()</code>方法。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #B00040">void</span> <span style="color: #0000FF">setup</span>() {
}

<span style="color: #B00040">void</span> <span style="color: #0000FF">loop</span>() {
}
</pre></td></tr></table></div>
<p><code>setup()</code>用於初始化設備，<code>loop()</code>用於執行階段的迴圈。</p>
<p>而加入Thinger.io程式庫後，您將需要先引入必須的程式庫，並且在<code>setup()</code>方法階段發起連線與定義該設備所擁有的資源(如繼電器、控制接腳、伺服馬達、需要被執行的函數等)，並於<code>loop()</code>階段不斷的調用<code>thing.handle();</code>來回應伺服器的要求。</p>
<p>因此結構會變成如此範例所示：</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #408080; font-style: italic">//引入任何需要使用的標頭檔</span>
<span style="color: #BC7A00">#include &lt;SPI.h&gt;;</span>
<span style="color: #BC7A00">#include &lt;Ethernet.h&gt;;</span>
<span style="color: #BC7A00">#include &lt;ThingerEthernet.h&gt;;</span>

<span style="color: #408080; font-style: italic">//初始化界面與資源</span>
ThingerEthernet <span style="color: #0000FF">thing</span>(<span style="color: #BA2121">&quot;username&quot;</span>, <span style="color: #BA2121">&quot;deviceId&quot;</span>, <span style="color: #BA2121">&quot;deviceCredential&quot;</span>);

<span style="color: #B00040">void</span> <span style="color: #0000FF">setup</span>() {
    <span style="color: #408080; font-style: italic">//初始化Sensor或任意接腳</span>

    <span style="color: #408080; font-style: italic">//初始化WiFi</span>

    <span style="color: #408080; font-style: italic">//在此新增您想披露至伺服器的資源(引腳、傳感器、LED等)</span>
}

<span style="color: #B00040">void</span> <span style="color: #0000FF">loop</span>() {
  <span style="color: #408080; font-style: italic">//請勿在此新增任何延遲(delay)，並保持隨時調用thing.handle()</span>
  thing.handle(); 
  <span style="color: #408080; font-style: italic">//在此可以呼叫終端還有傳遞您的串流資料</span>
}
</pre></td></tr></table></div>
<hr><h3 ex_nav id="設定驗證資訊">設定驗證資訊</h3>
<p>所有連接到雲端平台的設備都需要經過身分認證，其中包含三個部分：</p>
<ul>
    <li><code>username</code></li>
    <li><code>deviceId</code></li>
    <li><code>deviceCredential</code></li>
</ul>
<p>這將出現於程式中的<code>thing</code>物件實體化部分：</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1</pre></td><td><pre style="margin: 0; line-height: 125%">ThingerEthernet <span style="color: #0000FF">thing</span>(<span style="color: #BA2121">&quot;username&quot;</span>, <span style="color: #BA2121">&quot;deviceId&quot;</span>, <span style="color: #BA2121">&quot;deviceCredential&quot;</span>);
</pre></td></tr></table></div>

<p>請根據您在控制台中註冊設備時填寫或產生的<code>deviceId</code>與<code>deviceCredential</code>來進行修改，<code>username</code>則為您登入雲端控制台的使用者名稱(不是e-mail)。</p>
<p><strong>此物件必須在<code>setup()</code>前作為全域物件實體化。</strong></p>

<hr><h3 ex_nav id="開啟偵錯輸出">開啟偵錯輸出</h3>
<p>Thinger.io庫提供了對其活動的廣泛記錄，這在需要解決身份驗證和Wi-Fi連接問題時尤其有用。在草圖中包含以下定義，但在任何其他包含之前確保它首先出現（據報導在某些板上會導致崩潰）。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #BC7A00">#define _DEBUG_</span>
</pre></td></tr></table></div>
<p>由於所有除錯訊息都通過<mark>Serial</mark>顯示，因此還需要啟用<mark>Serial</mark>。請在<mark>Setup</mark>方法中啟用它。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #B00040">void</span> <span style="color: #0000FF">setup</span>() {
  Serial.begin(<span style="color: #666666">115200</span>);
}
</pre></td></tr></table></div>

<hr><h3 ex_nav id="新增資源">新增資源</h3>
<p>
    在 Thinger.io 平台中，每個設備都可以定義多個資源。您可以認為資源是您可以感測或觸發的任何資源。<br/>
    例如，典型的資源將是溫度或濕度等傳感器值，或者打開和關閉燈的繼電器。<br/>
</p>
<p>
    由於資源在初始化階段即被提供，因此需要在<code>setup()</code>方法中定義所有資源，初始化後則可根據需求對資源進行存取。
</p>
<p>
    資源的類型共有三種，將在以下各節中進行說明。
</p>
<nav>
  <div class="nav nav-tabs" role="tablist">
    <a class="nav-item nav-link active" id="nav-input-tab" data-toggle="tab" href="#nav-input" role="tab" aria-controls="nav-input" aria-selected="true"><strong>輸入類資源</strong></a>
    <a class="nav-item nav-link" id="nav-output-tab" data-toggle="tab" href="#nav-output" role="tab" aria-controls="nav-output" aria-selected="false"><strong>輸出類資源</strong></a>
    <a class="nav-item nav-link" id="nav-IO-tab" data-toggle="tab" href="#nav-IO" role="tab" aria-controls="nav-IO" aria-selected="false"><strong>輸入輸出資源</strong></a>
  </div>
</nav>
<div class="tab-content">
    <div class="tab-pane fade show active" id="nav-input" role="tabpanel" aria-labelledby="nav-input-tab">
        <p>
            如果您需要控制或啟動IoT設備，則需要定義輸入資源。通過這種方式，輸入資源可以為您的設備提供資訊。<br/>
            例如打開和關閉燈或繼電器，改變伺服馬達位置，調整設備參數等的資源。<br/>
            要定義輸入資源，請使用<code>&lt;&lt;</code>指向資源名稱的運算符，它使用C++ 11 Lambda函數來定義函數。<br/>
        </p>
        <p>
            範例為接受一個參數的輸入資源函數，<code>pson</code>是一種泛型，可以包含布林值，數字，浮點數，字符串，甚至是JSON文檔中的結構化資訊。<br/>
            以下小節將說明如何為典型用例定義不同的輸入資源。<br/>
        </p>
        <div class="accordion" id="input-sources">
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0 mt-0">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#input-source1" aria-expanded="true">
                            打開/關閉LED、繼電器等
                        </button>
                    </h2>
                </div>
        
                <div id="input-source1" class="collapse show" data-parent="#input-sources">
                    <div class="card-body">
                        <p>這種資源只需要一個開/關狀態，因此可以根據需要啟用或禁用它。由於pson類型包含多種數據類型，我們可以認為pson輸入函數的參數類似於布林值。<br>
                        因此，在setup函數內部，您可以放置​​一個名為led（您也可以使用任何其他名稱）的資源，其輸入參數類型可以使用pson。<br>
                        該示例將使用in參數上的三元運算符來打開/關閉數字引腳10 。<br></p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;led&quot;</span>] <span style="color: #666666">&lt;&lt;</span> [](pson<span style="color: #666666">&amp;</span> in){
    digitalWrite(<span style="color: #666666">10</span>, in <span style="color: #666666">?</span> HIGH <span style="color: #666666">:</span> LOW);
};
</pre></td></tr></table></div>

                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0 mt-0">
                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#input-source2" aria-expanded="false">
                            修改伺服馬達位置
                        </button>
                    </h2>
                </div>
                <div id="input-source2" class="collapse" data-parent="#input-sources">
                    <div class="card-body">
                        <p>修改伺服馬達位置非常類似於打開/關閉LED。但是，在這種情況下，必須使用整數值。<br>
                        由於pson類型可以包含多種數據類型，我們仍然可以將該pson類型用作整數值。<br></p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;servo&quot;</span>] <span style="color: #666666">&lt;&lt;</span> [](pson<span style="color: #666666">&amp;</span> in){
    myServo.write(in);
};
</pre></td></tr></table></div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0 mt-0">
                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#input-source3" aria-expanded="false">
                            更新變數
                        </button>
                    </h2>
                </div>
                <div id="input-source3" class="collapse" data-parent="#input-sources">
                    <div class="card-body">
                        <p>您還可以使用輸入資源更新變數，以便動態更改設備行為。在某些您希望臨時禁用警報，更改報告間隔，更新滯後值等情況下，這非常有用。通過這種方式，您可以定義其他資源來更改變量。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #B00040">float</span> hysteresis <span style="color: #666666">=</span> <span style="color: #666666">0</span>; <span style="color: #408080; font-style: italic">// defined as a global variable</span>
thing[<span style="color: #BA2121">&quot;hysteresis&quot;</span>] <span style="color: #666666">&lt;&lt;</span> [](pson<span style="color: #666666">&amp;</span> in){
    hysteresis <span style="color: #666666">=</span> in;
};
</pre></td></tr></table></div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0 mt-0">
                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#input-source4" aria-expanded="false">
                            傳遞多個參數
                        </button>
                    </h2>
                </div>
                <div id="input-source4" class="collapse" data-parent="#input-sources">
                    <div class="card-body">
                        <p>該pson數據類型，不僅可以容納不同的數據類型，也就是使用JSON文件完全相容。因此，您可以使用pson數據類型同時接收多個值。此範例將接收使用lat和lon鍵(key)存儲的兩個不同浮點數(value)。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;location&quot;</span>] <span style="color: #666666">&lt;&lt;</span> [](pson<span style="color: #666666">&amp;</span> in){
    <span style="color: #B00040">float</span> lat <span style="color: #666666">=</span> in[<span style="color: #BA2121">&quot;lat&quot;</span>];
    <span style="color: #B00040">float</span> lon <span style="color: #666666">=</span> in[<span style="color: #BA2121">&quot;lon&quot;</span>];
};
</pre></td></tr></table></div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0 mt-0">
                        <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#input-source5" aria-expanded="false">
                            在儀表板和API中顯示輸入資源狀態
                        </button>
                    </h2>
                </div>
                <div id="input-source5" class="collapse" data-parent="#input-sources">
                    <div class="card-body">
                        <p>
                            儀表板或API的工作方式是，當您打開它們時，它們會查詢相關資源以正確顯示其目前狀態，即開關打開或關閉。<br>                        這樣，當API或儀表板打開時，調用每個相關的輸入資源，在調用中接收空數據，因為無意控制資源（pson輸入將為空）。
                        </p>
                        <p>
                            那麼，Dashboards或API如何知道輸入資源的目前狀態是什麼？如果資源為空，則資源必須在輸入參數中設定其目前狀態，如果存在，則使用輸入值。這樣，我們可以獲得三個不同的東西：查詢目前資源狀態（不修改它），修改目前資源狀態，以及取得資源上的預期輸入（這是設備上的API資源管理器的工作方式）。
                        </p>
                        <p>
                            因此，實際上允許在儀表板或API中顯示資源的目前狀態的正確輸入資源定義將類似於此範例程式碼。
                        </p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;resource&quot;</span>] <span style="color: #666666">&lt;&lt;</span> [](pson<span style="color: #666666">&amp;</span> in){
    <span style="color: #008000; font-weight: bold">if</span>(in.is_empty()){
        in <span style="color: #666666">=</span> currentState;
    }
    <span style="color: #008000; font-weight: bold">else</span>{
        currentState <span style="color: #666666">=</span> in;
    }
}
</pre></td></tr></table></div>
                        <p>
                            如果沒有輸入物件，此示例代碼基本上返回目前狀態（如布林值，數字等），或使用傳入數據更新目前狀態。這可以很容易地適用於控制LED，同時在打開或更新時在儀表板中顯示其目前狀態。
                        </p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;led&quot;</span>] <span style="color: #666666">&lt;&lt;</span> [](pson<span style="color: #666666">&amp;</span> in){
    <span style="color: #008000; font-weight: bold">if</span>(in.is_empty()){
        in <span style="color: #666666">=</span> (<span style="color: #B00040">bool</span>) digitalRead(pin);
    }
    <span style="color: #008000; font-weight: bold">else</span>{
        digitalWrite(pin, in <span style="color: #666666">?</span> HIGH <span style="color: #666666">:</span> LOW);
    }
}
</pre></td></tr></table></div>
                        <p>注意：要控制數位引腳，只需使用<code>更易用的資源定義</code>部分中說明的方法。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tab-pane fade" id="nav-output" role="tabpanel" aria-labelledby="nav-output-tab">
        <p>
            當您需要感知或讀取傳感器值（如溫度，濕度等）時，通常應使用輸出資源。因此，輸出資源對於從設備中提取資訊非常有用。<br>
            為了定義輸出資源，使用操作符<code>&gt;&gt;</code>指出資源名稱，它使用C ++ 11 Lambda函數來定義輸出函數。<br>
            範例為接收一個參數的輸出資源函數，pson是一種泛型，可以包含布林值，數字，浮點數，字符串，甚至是JSON文檔中的結構化資訊。<br>
            以下小節將說明如何為典型用例定義不同的輸出資源。
        </p>
        <div class="accordion" id="output-sources">
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0 mt-0">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#output-source1" aria-expanded="true">
                            讀取傳感器值
                        </button>
                    </h2>
                </div>
        
                <div id="output-source1" class="collapse show" data-parent="#output-sources">
                    <div class="card-body">
                        <p>定義輸出資源與定義輸入資源非常相似，但在這種情況下，它使用運算符<code>&gt;&gt;</code>。在回調函數中，可以用任何我們想要的值替換out值，比如在這種情況下傳感器讀數的輸出。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;temperature&quot;</span>] <span style="color: #666666">&gt;&gt;</span> [](pson<span style="color: #666666">&amp;</span> out){
      out <span style="color: #666666">=</span> dht.readTemperature();
};
</pre></td></tr></table></div>

                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0 mt-0">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#output-source2" aria-expanded="false">
                            讀取多個數據
                        </button>
                    </h2>
                </div>
        
                <div id="output-source2" class="collapse" data-parent="#output-sources">
                    <div class="card-body">
                        <p>以相同的方式輸入資源可以同時接收多個值，輸出資源也可以提供多個數據。這是從GPS提供緯度和經度的示例。<br></p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;location&quot;</span>] <span style="color: #666666">&gt;&gt;</span> [](pson<span style="color: #666666">&amp;</span> out){
      out[<span style="color: #BA2121">&quot;lat&quot;</span>] <span style="color: #666666">=</span> gps.getLatitude();
      out[<span style="color: #BA2121">&quot;lon&quot;</span>] <span style="color: #666666">=</span> gps.getLongitude();
};
</pre></td></tr></table></div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0 mt-0">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#output-source3" aria-expanded="false">
                            取得變數數值
                        </button>
                    </h2>
                </div>
        
                <div id="output-source3" class="collapse" data-parent="#output-sources">
                    <div class="card-body">
                        <p>如果無法提供單個傳感器讀數，因為它正在進行某種數據收集，則輸出資源也可用於讀取變數，其中計算結果會經常更新。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #B00040">float</span> yaw <span style="color: #666666">=</span> <span style="color: #666666">0</span>; <span style="color: #408080; font-style: italic">// defined as a global variable</span>
thing[<span style="color: #BA2121">&quot;yaw&quot;</span>] <span style="color: #666666">&gt;&gt;</span> [](pson<span style="color: #666666">&amp;</span> out){
      out <span style="color: #666666">=</span> yaw;
};
</pre></td></tr></table></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="tab-pane fade" id="nav-IO" role="tabpanel" aria-labelledby="nav-IO-tab">
        <p>最後一種資源類型是一種資源，它不僅接受輸入或輸出，而且接受兩個參數。當您想要讀取依賴於輸入的輸出時，即當您需要向傳感器提供變化的參考值時，這非常有用。<br></p>
        <div class="accordion" id="IO-sources">
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0 mt-0">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#IO-source1" aria-expanded="true">
                            提供單個輸入並獲取輸出資源
                        </button>
                    </h2>
                </div>
        
                <div id="IO-source1" class="collapse show" data-parent="#IO-sources">
                    <div class="card-body">
                        <p>
                            這種資源通常由供應商定義。<br>
                            在這種情況下，該函數採用兩個不同的pson參數。一個用於輸入數據，另一個用於輸出數據。<br>
                            此示例使用BMP180傳感器提供高度讀數。它將參考高度作為輸入，並提供目前高度作為輸出。
                        </p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;altitude&quot;</span>] <span style="color: #666666">=</span> [](pson<span style="color: #666666">&amp;</span> in, pson<span style="color: #666666">&amp;</span> out){
    out <span style="color: #666666">=</span> bmp.readAltitude(in);
};
</pre></td></tr></table></div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0 mt-0">
                        <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#IO-source2" aria-expanded="false">
                            多輸入多輸出資源
                        </button>
                    </h2>
                </div>
                <div id="IO-source2" class="collapse" data-parent="#IO-sources">
                    <div class="card-body">
                        <p>您還可以定義更複雜的輸入/輸出資源（需要多個輸入值），以提供多個輸出值，例如此示例中包含value1和value2提供sum和mult值。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;in_out&quot;</span>] <span style="color: #666666">=</span> [](pson<span style="color: #666666">&amp;</span> in, pson<span style="color: #666666">&amp;</span> out){
    out[<span style="color: #BA2121">&quot;sum&quot;</span>] <span style="color: #666666">=</span> (<span style="color: #B00040">long</span>)in[<span style="color: #BA2121">&quot;value1&quot;</span>] <span style="color: #666666">+</span> (<span style="color: #B00040">long</span>)in[<span style="color: #BA2121">&quot;value2&quot;</span>];
    out[<span style="color: #BA2121">&quot;mult&quot;</span>] <span style="color: #666666">=</span> (<span style="color: #B00040">long</span>)in[<span style="color: #BA2121">&quot;value1&quot;</span>] <span style="color: #666666">*</span> (<span style="color: #B00040">long</span>)in[<span style="color: #BA2121">&quot;value2&quot;</span>];
};
</pre></td></tr></table></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<hr><h3 ex_nav id="沒有參數的資源">沒有參數的資源</h3>
<p>您也可以定義不需要任何輸入的資源，也不會生成任何輸出。它們就像可以根據需要執行的回調，例如重啟設備或執行一些必要的操作。<br>
在這種情況下，資源被定義為沒有任何輸入或輸出參數的函數。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;resource&quot;</span>] <span style="color: #666666">=</span> [](){
    <span style="color: #408080; font-style: italic">// write here your execution code</span>
};
</pre></td></tr></table></div>

<hr><h3 ex_nav id="更易用的資源定義">更易用的資源定義</h3>
<p>客戶端庫還包含一些有用的語法定義，用於更輕鬆地聲明資源，而無需考慮輸入或輸出資源。這種語法特性是自動擴展的腳本，以標準方式定義資源。<br>
使用這種定義的優點是，當您從API查詢時，您的資源將能夠處理狀態。<br>
例如，如果啟用或禁用了數位引腳，則可以在API資源管理器或儀表板中檢視其目前狀態。<br></p>
<nav>
  <div class="nav nav-tabs" role="tablist">
    <a class="nav-item nav-link active" id="nav-dig-tab" data-toggle="tab" href="#nav-dig" role="tab" aria-controls="nav-dig" aria-selected="true"><strong>控制數位引腳</strong></a>
    <a class="nav-item nav-link" id="nav-source-tab" data-toggle="tab" href="#nav-source" role="tab" aria-controls="nav-source" aria-selected="false"><strong>定義輸出資源</strong></a>
    <a class="nav-item nav-link" id="nav-var-tab" data-toggle="tab" href="#nav-var" role="tab" aria-controls="nav-var" aria-selected="false"><strong>修改變數</strong></a>
    <a class="nav-item nav-link" id="nav-servo-tab" data-toggle="tab" href="#nav-servo" role="tab" aria-controls="nav-servo" aria-selected="false"><strong>控制伺服馬達</strong></a>
  </div>
</nav>
<div class="tab-content">
    <div class="tab-pane fade show active" id="nav-dig" role="tabpanel" aria-labelledby="nav-dig-tab">
    <p>
        這種資源將允許定義用於聲明對數位引腳的控制的資源，因此您可以交替開啟/關閉狀態，可以用於控制LED，繼電器，燈等。<br>
        需要在設定程式碼中將數位引腳定義為OUTPUT，否則資源將無法正常工作。
    </p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;relay&quot;</span>] <span style="color: #666666">&lt;&lt;</span> digitalPin(PIN_NUMBER);
thing[<span style="color: #BA2121">&quot;relay&quot;</span>] <span style="color: #666666">&lt;&lt;</span> invertedDigitalPin(PIN_NUMBER);
</pre></td></tr></table></div>
    </div>
    <div class="tab-pane fade" id="nav-source" role="tabpanel" aria-labelledby="nav-source-tab">
        <p>
            這種資源定義用於宣告唯讀資源，例如從傳感器獲取的值，或者我們程式中的初始化變數。<br>
            在這個例子中，我們定義了一個暴露傳感器讀數的資源，比如DHT11傳感器溫度。
        </p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;temperature&quot;</span>] <span style="color: #666666">&gt;&gt;</span> outputValue(dht.readTemperature());
</pre></td></tr></table></div>
        <p>我們也可以在程式中為任何全域變數定義輸出資源。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;variable&quot;</span>] <span style="color: #666666">&gt;&gt;</span> outputValue(myVar);
</pre></td></tr></table></div>
    </div>
    <div class="tab-pane fade" id="nav-var" role="tabpanel" aria-labelledby="nav-var-tab">
        <p>
            我們的程式通常定義一些在循環中使用的參數或變數。這種資源通常用於處理或控制行為。<br>
            有了這種資源，我們可以修改我們想要公開的任何參數，比如浮點數，整數，布林值等。
        </p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;logging&quot;</span>] <span style="color: #666666">&lt;&lt;</span> inputValue(sdLogging);
</pre></td></tr></table></div>
        <p>
            也可以定義一個回調函數來知道變數何時發生了變化，因此我們可以執行任何其他操作。<br>
            對於此用例，請將資源定義為以下內容，以便在<code>hysteresisVar</code>更改時執行某些代碼。
        </p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;hysteresis&quot;</span>] <span style="color: #666666">&lt;&lt;</span> inputValue(hysteresisVar, {
    <span style="color: #408080; font-style: italic">// execute some code when the value change</span>
    Serial.println(<span style="color: #BA2121">&quot;Hystereis changed to: &quot;</span>);
    Serial.print(hysteresisVar);
});
</pre></td></tr></table></div>
    </div>
    <div class="tab-pane fade" id="nav-servo" role="tabpanel" aria-labelledby="nav-servo-tab">
        <p>還可以定義用於控制伺服馬達的資源。這樣，定義的資源將根據API互動自動處理您的伺服馬達，讀取或更新其位置。</p>
        <p>要定義伺服資源，只需像往常一樣定義和初始化伺服機，然後在資源定義中使用聲明的實例。</p>
        <!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1</pre></td><td><pre style="margin: 0; line-height: 125%">thing[<span style="color: #BA2121">&quot;servo&quot;</span>] <span style="color: #666666"><<</span> servo(myServoInstance);
</pre></td></tr></table></div>
    </div>
</div>
<hr>
<h3 ex_nav id="裝置間的橫向溝通">裝置間的橫向溝通</h3>
<p>在Thinger.io中，設備可以在它們之間進行通信。這裡有兩種狀況。一個是來自同一帳戶的設備之間的通信，另一個是來自不同帳戶的設備之間的通信。我們將描述兩種不同的方法：</p>
<nav>
    <div class="nav nav-tabs" role="tablist">
        <a class="nav-item nav-link active" id="nav-same-account-tab" data-toggle="tab" href="#nav-same-account" role="tab" aria-controls="nav-same-account" aria-selected="true">裝置位於同一個帳戶管理下</a>
        <a class="nav-item nav-link" id="nav-different-account-tab" data-toggle="tab" href="#nav-different-account" role="tab" aria-controls="nav-different-account" aria-selected="false">裝置位於不同帳戶</a>
    </div>
</nav>
<div class="tab-content">
    <div class="tab-pane fade show active" id="nav-same-account" role="tabpanel" aria-labelledby="nav-same-account-tab">
        <p>對於此用例，設備可以使用特定方法與其他設備進行通信。假設我們有一個<mark>deviceA</mark>，並且<mark>deviceB</mark>想要在它們之間進行通信。</p>
        <p>在<mark>deviceA</mark>定義如下面的例子一樣的資源。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5</pre></td><td><pre style="margin: 0; line-height: 125%">setup(){
    thing[<span style="border: 1px solid #FF0000">"</span>resourceOnA<span style="border: 1px solid #FF0000">"</span>] <span style="color: #666666">=</span> [](){
        Serial.println(<span style="color: #BA2121">&quot;Someone is calling me!&quot;</span>);
    };
}
</pre></td></tr></table></div>
        <p><mark>deviceB</mark>可以通過運行以下命令輕鬆調用此方法。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5</pre></td><td><pre style="margin: 0; line-height: 125%">loop(){
    thing.handle();
    <span style="color: #408080; font-style: italic">// be sure to call it at an appropiate rate</span>
    thing.call_device(<span style="color: #BA2121">&quot;deviceA&quot;</span>, <span style="color: #BA2121">&quot;resourceOnA&quot;</span>);
}
</pre></td></tr></table></div>
        <p><mark>deviceA</mark>也可以定義具有一些預期輸入的資源。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7</pre></td><td><pre style="margin: 0; line-height: 125%">setup(){
    thing[<span style="border: 1px solid #FF0000">"</span>resourceOnA<span style="border: 1px solid #FF0000">"</span>] <span style="color: #666666">&lt;&lt;</span> [](pson<span style="color: #666666">&amp;</span> in){
        <span style="color: #B00040">int</span> val1 <span style="color: #666666">=</span> in[<span style="color: #BA2121">&quot;anyValue1&quot;</span>];
        <span style="color: #B00040">float</span> val2 <span style="color: #666666">=</span> in[<span style="color: #BA2121">&quot;anyValue2&quot;</span>];
        <span style="color: #408080; font-style: italic">// Work with the updated parameters here</span>
    };
}
</pre></td></tr></table></div>
        <p><mark>deviceB</mark>也可以通過定義一個<mark>pson</mark>填充了相同key的類型來調用此方法來提供<mark>resourceOnA</mark>適當的輸入</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8</pre></td><td><pre style="margin: 0; line-height: 125%">loop(){
    thing.handle();
    <span style="color: #408080; font-style: italic">// be sure to call it at an appropiate rate</span>
    pson data;
    data[<span style="color: #BA2121">&quot;anyValue1&quot;</span>] <span style="color: #666666">=</span> <span style="color: #666666">3</span>;
    data[<span style="color: #BA2121">&quot;anyValue2&quot;</span>] <span style="color: #666666">=</span> <span style="color: #666666">43.1</span>;
    thing.call_device(<span style="color: #BA2121">&quot;deviceA&quot;</span>, <span style="color: #BA2121">&quot;resourceOnA&quot;</span>, data);
}
</pre></td></tr></table></div>
        <p><mark>deviceB</mark> 也可以通過提供來自回傳數據的已定義資源的數據來調用此方法，在這種情況下，調用與前面的示例類似，但使用資源作為數據源。</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></td><td><pre style="margin: 0; line-height: 125%">setup(){
    thing[<span style="color: #BA2121">&quot;resourceName&quot;</span>] <span style="color: #666666">&gt;&gt;</span> [](pson<span style="color: #666666">&amp;</span> out){
        out[<span style="color: #BA2121">&quot;anyValue1&quot;</span>] <span style="color: #666666">=</span> <span style="color: #666666">3</span>;
        out[<span style="color: #BA2121">&quot;anyValue2&quot;</span>] <span style="color: #666666">=</span> <span style="color: #666666">43.1</span>;
    };
}
loop(){
    thing.handle();
    <span style="color: #408080; font-style: italic">// be sure to call it at an appropiate rate</span>
    thing.call_device(<span style="color: #BA2121">&quot;deviceA&quot;</span>, <span style="color: #BA2121">&quot;resourceOnA&quot;</span>, thing[<span style="color: #BA2121">&quot;resourceName&quot;</span>]);
}
</pre></td></tr></table></div>
    </div>
    <div class="tab-pane fade" id="nav-different-account" role="tabpanel" aria-labelledby="nav-different-account-tab">
        <p>如果我們想要通過不同帳戶進行通信，我們可以通過調用類型的端點來實現<mark>Thinger.io Device Call</mark>只需在控制台中註冊此類型的端點，如下例所示。</p>
        <img class="img-fluid" src="./img/Thinger.io/Coding/device_call.png">
        <p>
            在這種情況下，需要在端點中定義不同的參數：
            <ul>
                <li>端點標識符：設備用於調用設備的端點ID。</li>
                <li>設備所有者：設備所有者用戶名。</li>
                <li>設備標識符：其他帳戶的設備ID。</li>
                <li>資源名稱：要調用的設備上的資源。</li>
                <li>設備存取令牌(token)：在另一個帳戶中生成的設備令牌，用於授予對設備的外部存取權限。</li>
            </ul>
            定義後，設備將能夠調用端點，如以下部分所述。它基本上包括調用<mark>call_endpoint</mark>方法。
        </p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1</pre></td><td><pre style="margin: 0; line-height: 125%">thing.call_endpoint(<span style="color: #BA2121">&quot;DeviceACall&quot;</span>);
</pre></td></tr></table></div>
    </div>
</div>

<hr><h3 ex_nav id="端點">端點</h3>
<p>
    在Thinger.io中，端點被定義為可由設備存取的某種外部資源。借助端點功能，設備可以輕鬆地向外部Web服務發送電子郵件、SMS、推送數據，與IFTTT互動以及使用WebHooks（調用HTTP / HTTPS URL）可以執行的任何操作。
</p>
<p>
    從Arduino裝置上調用端點非常簡單，因為只需要在<code>thing</code>變數上調用<code>call_endpoint</code>方法。
</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1</pre></td><td><pre style="margin: 0; line-height: 125%">thing.call_endpoint(<span style="color: #BA2121">&quot;endpoint_id&quot;</span>);
</pre></td></tr></table></div>
<p>
    您可以簡單地調用端點來執行某些操作，例如發送預定義的電子郵件，或者還使用某些數據調用端點，這在您使用使用設備數據的第三方服務時特別有用。
</p>
<div class="alert alert-warning">
    在調用資源時應特別注意，並以適當的速率調用它們。否則，您將很容易消耗大量傳輸流量、寄出數百封電子郵件或在第三方服務中大量消耗API​​調用次數。
</div>
<nav>
    <div class="nav nav-tabs" role="tablist">
        <a class="nav-item nav-link active" id="nav-call-endpoint-tab" data-toggle="tab" href="#nav-call-endpoint" role="tab" aria-controls="nav-call-endpoint" aria-selected="true">調用端點</a>
        <a class="nav-item nav-link" id="nav-push-data-tab" data-toggle="tab" href="#nav-push-data" role="tab" aria-controls="nav-push-data" aria-selected="false">推送數據</a>
        <a class="nav-item nav-link" id="nav-email-tab" data-toggle="tab" href="#nav-email" role="tab" aria-controls="nav-email" aria-selected="false">發送電子郵件</a>
    </div>
</nav>
<div class="tab-content">
    <div class="tab-pane fade show active" id="nav-call-endpoint" role="tabpanel" aria-labelledby="nav-call-endpoint-tab">
        <p>
            這個簡單的範例將向您示範如何根據溫度來傳送高溫警報的email，對於範例我們已經先配置了一個名為<code>high_temp_email</code>的電子郵件端點，其中包含有關溫度的警告文本。
        </p>
        <p>
            在此範例，我們不會希望每毫秒檢查溫度，因此引入一些參數來控制感測與發送警告的頻率。此範例中將每小時檢查一次溫度，如果溫度高於30ºC，它將調用<code>high_temp_email</code>端點，該端點將向我們發送包含預定義文本的電子郵件。
        </p>
        <p>
            請不要在<code>loop()</code>方法中加入延遲，因為它會阻止<code>thing.handle()</code>方法執行，因此<code>millis()</code>函數的非阻塞延遲是個好方法。
        </p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #B00040">unsigned</span> <span style="color: #B00040">long</span> lastCheck <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
loop(){
    thing.handle(); <span style="color: #408080; font-style: italic">// required thing handle</span>
    <span style="color: #B00040">unsigned</span> <span style="color: #B00040">long</span> currentTs <span style="color: #666666">=</span> millis();
    <span style="color: #008000; font-weight: bold">if</span>(currentTs<span style="color: #666666">-</span>lastCheck<span style="color: #666666">&gt;=60*60*1000</span>){
        lastCheck <span style="color: #666666">=</span> currentTs;
        <span style="color: #008000; font-weight: bold">if</span>(dht.readTemperature()<span style="color: #666666">&gt;30</span>){
            thing.call_endpoint(<span style="color: #BA2121">&quot;high_temp_email&quot;</span>);
        }
    }
}
</pre></td></tr></table></div>
        <p>
            您可以在此處建立給感測器調用的端點，例如：您的濕度傳感器報告您的植物中沒有水、設備的位置不符合預期以及許多其他狀況時可以進行調用。
            使用端點的另一種有趣方式是將其與IFTTT集成，因此您可以與多個第三方服務進行互動！
        </p>
    </div>
    <div class="tab-pane fade" id="nav-push-data" role="tabpanel" aria-labelledby="nav-push-data-tab">
        <p>
            將數據推送到端點（採用JSON格式）也非常簡單。
            我們需要調用<code>call_endpoint</code>方法，但在這種情況下，根據<code>pson</code>數據格式添加一些資訊，這些資訊將自動轉換為JSON。
            例如，如果我們想要將數據報告給像<code>Keen.io</code>這樣的第三方服務，我們可以在控制台中建立這種端點。
            設定完成後，我們可以在調用端點時報告讀數，例如DHT傳感器的濕度和溫度值。
        </p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #408080; font-style: italic">// be careful of sending data at an appropriate rate!</span>
pson data;
data[<span style="color: #BA2121">&quot;temperature&quot;</span>] <span style="color: #666666">=</span> dht.readTemperature();
data[<span style="color: #BA2121">&quot;humidity&quot;</span>] <span style="color: #666666">=</span> dht.readHumidity();
thing.call_endpoint(<span style="color: #BA2121">&quot;keen_endpoint&quot;</span>, data);
</pre></td></tr></table></div>
        <p>
            您還可以根據已定義的資源發送數據，即假設您有一個已經提供溫度和濕度的資源。可以重複使用此定義將相同的數據發送到端點，而無需重新定義傳感器讀數，如下例所示。
        </p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></td><td><pre style="margin: 0; line-height: 125%">setup(){
    <span style="color: #408080; font-style: italic">// defined resource in the setup for reading a sensor value</span>
    thing[<span style="color: #BA2121">&quot;data&quot;</span>] <span style="color: #666666">&gt;&gt;</span> (pson<span style="color: #666666">&amp;</span> out){
        out[<span style="color: #BA2121">&quot;temperature&quot;</span>] <span style="color: #666666">=</span> dht.readTemperature();
        out[<span style="color: #BA2121">&quot;humidity&quot;</span>] <span style="color: #666666">=</span> dht.readHumidity();
    }
}

loop(){
    <span style="color: #408080; font-style: italic">// be careful of sending data at an appropriate rate!</span>
    thing.call_endpoint(<span style="color: #BA2121">&quot;endpoint&quot;</span>, thing[<span style="color: #BA2121">&quot;data&quot;</span>]);
}
</pre></td></tr></table></div>
    </div>
    <div class="tab-pane fade" id="nav-email" role="tabpanel" aria-labelledby="nav-email-tab">
        <p>
            這是一個簡單的示例，應用於具有自定義正文的電子郵件類型端點
        </p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></td><td><pre style="margin: 0; line-height: 125%">setup()
{
 thing[<span style="color: #BA2121">&quot;Level&quot;</span>] <span style="color: #666666">&gt;&gt;</span> outputValue(actualRelative);
}
loop()
{
 <span style="color: #008000; font-weight: bold">if</span>(actualLevel<span style="color: #666666">&gt;</span>UpperLevel <span style="color: #666666">&amp;&amp;</span> endpointUpperFlag)
   {
    thing.call_endpoint(<span style="color: #BA2121">&quot;endpoint_id&quot;</span>,thing[<span style="color: #BA2121">&quot;Level&quot;</span>]);
    endpointUpperFlag<span style="color: #666666">=0</span>;
   }
}
</pre></td></tr></table></div>
        <p>
            請注意，有一個變數限制了此"if"只運行一次，重要的是定義任何條件或方法以保證這種enpoint調用只執行一次（或以適當的速率），因為它可以得到一個微控制器通過thinger.io平台生成的大量電子郵件。在端點配置中，在自定義正文電子郵件中，必須添加雙括號"{{}}"來調用微控制器發送的變數，在我們的示例中，我們使用了以下正文：
        </p>
        <p><strong>"實際水平為{{}}％"</strong></p>
        <p>並收到一封帶有文字的電子郵件：</p>
        <p><strong>實際水平為80.34％</strong></p>
    </div>
</div>
<hr>
<h3 ex_nav id="使用資料儲存區">使用資料儲存區</h3>
<p>
    Thinger.io提供一個易用且富有擴充性的虛擬儲存系統，該系統允許存儲來自設備輸出資源的長期數據。並可於儀表板中將其可視化，也可以使用不同格式導出數據進行其它處理或第三方資料分析。
</p>
<h4>自設備讀取資源</h4>
<p>此方式無須編寫特定方法即可使用，因為他們將透過雲端平台自動蒐集資料，僅須建立數據統並設定採樣間隔即可，如控制台文檔所述。</p>
<h4>串流寫入</h4>
<p>
    此方式可藉由在資料儲存區在設定時使用"Update from device"選項，並且使用串流媒體資源指令，如下所述：
</p>
<p>此例使用事先定義的輸出資源，我們稱它為["location"]，它看起來像下面這樣：</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7</pre></td><td><pre style="margin: 0; line-height: 125%"> <span style="color: #B00040">void</span> <span style="color: #0000FF">loop</span>() {
  thing.handle();
  <span style="color: #408080; font-style: italic">// use your own logic here to determine when to stream/record the resource.</span>
  <span style="color: #008000; font-weight: bold">if</span>(requires_recording){
      thing.stream(<span style="color: #BA2121">&quot;location&quot;</span>);
  }
}
</pre></td></tr></table></div>
<h4>由設備主動寫入</h4>
<p>
    此選項將允許設定資料儲存區為不讀取任何資訊而是等待調用寫入命令的狀態，Arduino可以使用write_bucket方法(如此例)，而Sigfox也可以直接調用REST API來完成。此功能可以將來自不同設備的資訊寫入至同一個儲存區中，或是存儲來自與伺服器未建立永久連接、處於睡眠狀態或諸如Sigfox之類的設備所提供的資訊。
</p>
<p>
    以下是ESP8266裝置使用write_bucket函數將資訊寫入的範例：
</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #B00040">void</span> <span style="color: #0000FF">setup</span>() {
  <span style="color: #408080; font-style: italic">// define the resource with temperature and humidity</span>
  thing[<span style="color: #BA2121">&quot;door_status&quot;</span>] <span style="color: #666666">&gt;&gt;</span> [](pson <span style="color: #666666">&amp;</span>out){ 
    out[<span style="color: #BA2121">&quot;OPEN&quot;</span>] <span style="color: #666666">=</span> (<span style="color: #B00040">bool</span>)digitalRead(SENSOR_PIN);
  };
}

<span style="color: #B00040">void</span> <span style="color: #0000FF">loop</span>() { 
  <span style="color: #408080; font-style: italic">// handle connection</span>
  thing.handle();

  <span style="color: #008000; font-weight: bold">if</span>(digitalRead(SENSOR_PIN)<span style="color: #666666">!=</span>previous_status){
    <span style="color: #408080; font-style: italic">// write to bucket BucketId when the door changes its status</span>
    thing.write_bucket(<span style="color: #BA2121">&quot;BucketId&quot;</span>, <span style="color: #BA2121">&quot;door_status&quot;</span>);
  }
  previous_status<span style="color: #666666">=</span>digitalRead(SENSOR_PIN);
}
</pre></td></tr></table></div>
<!--p>
    請注意：此指令將搜尋["door_status"]之PSON資源，因此也可以附加自訂易PSON來調用此函數，如下所示：
</p>
<div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #B00040">void</span> <span style="color: #0000FF">loop</span>(){
  <span style="color: #408080; font-style: italic">// handle connection</span>
  thing.handle();

  <span style="color: #008000; font-weight: bold">if</span>(digitalRead(SENSOR_PIN)<span style="color: #666666">!=</span>previous_status){
    <span style="color: #408080; font-style: italic">// write to bucket BucketId when the door changes its status</span>
    thing.write_bucket(<span style="color: #BA2121">&quot;BucketId&quot;</span>, <span style="color: #BA2121">&quot;door_status&quot;</span>);
  }
  previous_status<span style="color: #666666">=</span>digitalRead(SENSOR_PIN);
}
</pre></td></tr></table></div>

<div class="alert alert-warning">
    建置中...
</div-->
<hr>
<h3 ex_nav id="串流資源">串流資源</h3>
<p>
    在Thinger.io中，您可以建立與設備相關的WebSockets連接，這樣您就可以即時接收傳感器值，事件或任何其他訊息。WebSockets主要用於控制台的儀表板功能，通常用於以固定的可設定間隔傳輸資源。<br>
    定義輸出資源時，此功能可立即使用。但是，如果您希望在需要時立即傳輸信息，例如當您的設備檢測到移動，存在等時，您必須編寫一些程式，這與調用端點非常相似。
</p>
<p>
    例如加速計值超過某個閾值，您的傳感器正在進行偵測，或者羅盤方向是否正在發生變化，在這種情況下，您可以決定何時需要傳輸新數據。
</p>
<p>
    串流資源還要求另一個端點連接並偵聽它們（即WebSocket的client端），因此如果沒有人監聽此數據，則不會發送數據。這由客戶端庫和伺服器自動處理，因此始終流式傳輸數據是安全的，因為設備僅在有目的地時才傳輸信息。
</p>
<p>
    如果航向值變化超過1度，以下示例將即時報告羅盤航向。
</p>
</pre>
<img class="img-fluid" src="./img/Thinger.io/Coding/esp8266-real-time-websockets.gif">
<p>以下是範例所使用的程式</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></td><td><pre style="margin: 0; line-height: 125%"><span style="color: #B00040">void</span> <span style="color: #0000FF">setup</span>(){
  thing[<span style="color: #BA2121">&quot;heading&quot;</span>] <span style="color: #666666">&gt;&gt;</span> [](pson<span style="color: #666666">&amp;</span> out){     
    out <span style="color: #666666">=</span> getHeading();
  };
}

<span style="color: #B00040">float</span> previousHeading <span style="color: #666666">=</span> <span style="color: #666666">0</span>;
<span style="color: #B00040">void</span> <span style="color: #0000FF">loop</span>() {
  thing.handle();
  <span style="color: #B00040">float</span> currentHeading <span style="color: #666666">=</span> getHeading();
  <span style="color: #008000; font-weight: bold">if</span>(abs(currentHeading<span style="color: #666666">-</span>previousHeading)<span style="color: #666666">&gt;=1.0f</span>){
    thing.stream(thing[<span style="color: #BA2121">&quot;heading&quot;</span>]);
    previousHeading<span style="color: #666666">=</span>currentHeading;
  }
}
</pre></td></tr></table></div>
<hr>
<h3 ex_nav id="esp8266-深層睡眠與智慧設定">ESP8266 深層睡眠與SmartConfig</h3>
<p>
    <mark>SmartConfig</mark>允許用戶通過同一網路（例如智慧型手機或其他wifi客戶端）上的外部設備設定主板的WiFi憑證。這意味著沒有敏感訊息寫入韌體或設備上的設定文件。
</p>
<p>
    <mark>Deep Sleep</mark>是ESP8266的一種特殊模式，它允許它關閉大部分電路並在一些可配置的時間後喚醒。
    要使深度睡眠（和喚醒）正常工作，必須連接<mark>GPIO16</mark>（通常是開發板的<mark>D0</mark>）和<mark>RST</mark>引腳。
</p>
<p>
    但是，有些電路板選擇將內建LED連接到<mark>D0</mark>引腳，由於該類別在執行時使用LED作為除錯輔助工具，因此使用<mark>ThingerSmartConfig</mark>類時將進入崩潰循環。<br>
    解決方案是使用重構函數並禁用其使用LED。
</p>
<!-- HTML generated using hilite.me --><div style="background: #f8f8f8; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><table><tr><td><pre style="margin: 0; line-height: 125%">1
2
3
4</pre></td><td><pre style="margin: 0; line-height: 125%">ThingerSmartConfig <span style="color: #0000FF">thing</span>(USERNAME,
                         DEVICE_ID,
                         DEVICE_CREDENTIAL,
                         <span style="color: #008000">false</span>); <span style="color: #408080; font-style: italic">// required for deep sleep</span>
</pre></td></tr></table></div>
<hr>

<h2 ex_nav id="互動">互動</h2>
<p>
    一旦您定義了資源並且設備已連接到平台，就可以在幾分鐘內輕鬆地與您的設備進行互動。有幾種互動方式，例如建立儀表板，使用移動設備應用存取（目前僅在Android中），從API資源管理器存取或直接調用API。
</p>
<hr><h3 id="android">Android</h3>
<p>存取設備最簡單的方法之一就是產生設備令牌來授予對設備的存取權。產生令牌時可以限制共享資源與有效期限，因此可以與他人安全的共享某些設備功能。控制台中將可以產生這個設備的令牌並且將其產生給予Android APP掃描的QRCode</p>
<img class="img-fluid" src="./img/Thinger.io/Coding/token.png">
<hr><h4 id="手機端應用程式">手機端應用程式</h4>
<p>
    目前版本的Android APP不需要任何登錄即可與您的設備進行互動。僅需掃描令牌的QRCode，您的手機就可以立即與您的設備互動－讀取傳感器值、更改LED或繼電器狀態等。
</p>
<img class="img-fluid" src="./img/Thinger.io/Coding/phone.png">
<!--hr><h4 id="穿戴型裝置">穿戴型裝置</h4-->

<hr><h3 id="雲端控制台">雲端控制台</h3>
<p>
    Cloud Console為隨插即用的設備互動加入了一些支援。
</p>
<p>
    您可以從API資源管理器與設備進行互動，也可以創建即時儀表板以顯示設備訊息。沒有必要編寫額外的程式碼來支援這種互動，只需在您的設備中聲明您的資源，您就可以直接在控制台中存取它們。
</p>
<p>
    因此，本節將介紹雲控制台的不同互動方法。
</p>
<hr><h4 id="儀表板">儀表板</h4>
<p>
    在控制台中，您可以輕鬆建立和設定即時儀表板，以顯示設備數據，如傳感器。您只需選擇設備，關聯資源，然後選擇更新方法，可以是可設定的採樣間隔，也可以根據設備的要求進行更新。
</p>
<img class="img-fluid" src="./img/Thinger.io/Coding/dashboards.gif">
<hr><h4 id="api-探索">API 資源管理器</h4>
<p>
    與API設備互動的另一種方式是使用API​​ Explorer。您可以從API Explorer自動存取設備中的每個已定義資源，以便您可以讀取數據，發送指令或值，調用函數等。
</p>
<p>
    如果要使用Server API與設備進行互動，此功能非常有用，因此您可以輕鬆地可視化設備公開的API以及預期的輸入和輸出。<br>
    此外，在您的設備上編寫程式碼時非常重要，因此您可以輕鬆檢查資源是否按預期工作，例如讀取傳感器值，打開和關閉繼電器等等。
</p>
<div class="alert alert-info">
    設備中的每個已定義資源（如傳感器，繼電器，指示燈等）都可以從API資源管理器中直接存取。此示例直接從資源管理器打開和關閉指示燈。
</div>
<div id="guidePages"></div>